//XHook - v1.6.2 - https://github.com/jpillora/xhook
//Jaime Pillora <dev@jpillora.com> - MIT Copyright 2023
var xhook=function(){"use strict";const e=(e,t)=>Array.prototype.slice.call(e,t);let t=null;"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?t=self:"undefined"!=typeof global?t=global:window&&(t=window);const n=t,o=t.document,s=["load","loadend","loadstart"],r=["progress","abort","error","timeout"],a=e=>["returnValue","totalSize","position"].includes(e),i=function(e,t){for(let n in e){if(a(n))continue;const o=e[n];try{t[n]=o}catch(e){}}return t},c=function(e,t,n){const o=e=>function(o){const s={};for(let e in o){if(a(e))continue;const r=o[e];s[e]=r===t?n:r}return n.dispatchEvent(e,s)};for(let s of Array.from(e))n._has(s)&&(t[`on${s}`]=o(s))},u=function(t){let n={};const s=e=>n[e]||[],r={addEventListener:function(e,t,o){n[e]=s(e),n[e].indexOf(t)>=0||(o=void 0===o?n[e].length:o,n[e].splice(o,0,t))},removeEventListener:function(e,t){if(void 0===e)return void(n={});void 0===t&&(n[e]=[]);const o=s(e).indexOf(t);-1!==o&&s(e).splice(o,1)}};return r.dispatchEvent=function(){const n=e(arguments),a=n.shift();t||(n[0]=i(n[0],function(e){if(o&&null!=o.createEventObject){const t=o.createEventObject();return t.type=e,t}try{return new Event(e)}catch(t){return{type:e}}}(a)),Object.defineProperty(n[0],"target",{writable:!1,value:this}));const c=r[`on${a}`];c&&c.apply(r,n);const u=s(a).concat(s("*"));for(let e=0;e<u.length;e++){u[e].apply(r,n)}},r._has=e=>!(!n[e]&&!r[`on${e}`]),t&&(r.listeners=t=>e(s(t)),r.on=r.addEventListener,r.off=r.removeEventListener,r.fire=r.dispatchEvent,r.once=function(e,t){var n=function(){return r.off(e,n),t.apply(null,arguments)};return r.on(e,n)},r.destroy=()=>n={}),r};var l=function(e,t){switch(typeof e){case"object":return n=e,Object.entries(n).map((([e,t])=>`${e.toLowerCase()}: ${t}`)).join("\r\n");case"string":return function(e,t){const n=e.split("\r\n");null==t&&(t={});for(let e of n)if(/([^:]+):\s*(.+)/.test(e)){const e=null!=RegExp.$1?RegExp.$1.toLowerCase():void 0,n=RegExp.$2;null==t[e]&&(t[e]=n)}return t}(e,t)}var n;return[]};const d=u(!0),f=e=>void 0===e?null:e,p=n.XMLHttpRequest,h=function(){const e=new p,t={};let n,o,a,h=null;var y=0;const v=function(){if(a.status=h||e.status,-1!==h&&(a.statusText=e.statusText),-1===h);else{const t=l(e.getAllResponseHeaders());for(let e in t){const n=t[e];if(!a.headers[e]){const t=e.toLowerCase();a.headers[t]=n}}}},E=function(){b.status=a.status,b.statusText=a.statusText},g=function(){n||b.dispatchEvent("load",{}),b.dispatchEvent("loadend",{}),n&&(b.readyState=0)},m=function(e){for(;e>y&&y<4;)b.readyState=++y,1===y&&b.dispatchEvent("loadstart",{}),2===y&&E(),4===y&&(E(),"text"in a&&(b.responseText=a.text),"xml"in a&&(b.responseXML=a.xml),"data"in a&&(b.response=a.data),"finalUrl"in a&&(b.responseURL=a.finalUrl)),b.dispatchEvent("readystatechange",{}),4===y&&(!1===t.async?g():setTimeout(g,0))},L=function(e){if(4!==e)return void m(e);const n=d.listeners("after");var o=function(){if(n.length>0){const e=n.shift();2===e.length?(e(t,a),o()):3===e.length&&t.async?e(t,a,o):o()}else m(4)};o()};var b=u();t.xhr=b,e.onreadystatechange=function(t){try{2===e.readyState&&v()}catch(e){}4===e.readyState&&(o=!1,v(),function(){if(e.responseType&&"text"!==e.responseType)"document"===e.responseType?(a.xml=e.responseXML,a.data=e.responseXML):a.data=e.response;else{a.text=e.responseText,a.data=e.responseText;try{a.xml=e.responseXML}catch(e){}}"responseURL"in e&&(a.finalUrl=e.responseURL)}()),L(e.readyState)};const x=function(){n=!0};b.addEventListener("error",x),b.addEventListener("timeout",x),b.addEventListener("abort",x),b.addEventListener("progress",(function(t){y<3?L(3):e.readyState<=3&&b.dispatchEvent("readystatechange",{})})),"withCredentials"in e&&(b.withCredentials=!1),b.status=0;for(let e of Array.from(r.concat(s)))b[`on${e}`]=null;if(b.open=function(e,s,r,i,c){y=0,n=!1,o=!1,t.headers={},t.headerNames={},t.status=0,t.method=e,t.url=s,t.async=!1!==r,t.user=i,t.pass=c,a={},a.headers={},L(1)},b.send=function(n){let u,l;for(u of["type","timeout","withCredentials"])l="type"===u?"responseType":u,l in b&&(t[u]=b[l]);t.body=n;const f=d.listeners("before");var p=function(){if(!f.length)return function(){for(u of(c(r,e,b),b.upload&&c(r.concat(s),e.upload,b.upload),o=!0,e.open(t.method,t.url,t.async,t.user,t.pass),["type","timeout","withCredentials"]))l="type"===u?"responseType":u,u in t&&(e[l]=t[u]);for(let n in t.headers){const o=t.headers[n];n&&e.setRequestHeader(n,o)}e.send(t.body)}();const n=function(e){if("object"==typeof e&&("number"==typeof e.status||"number"==typeof a.status))return i(e,a),"data"in e||(e.data=e.response||e.text),void L(4);p()};n.head=function(e){i(e,a),L(2)},n.progress=function(e){i(e,a),L(3)};const d=f.shift();1===d.length?n(d(t)):2===d.length&&t.async?d(t,n):n()};p()},b.abort=function(){h=-1,o?e.abort():b.dispatchEvent("abort",{})},b.setRequestHeader=function(e,n){const o=null!=e?e.toLowerCase():void 0,s=t.headerNames[o]=t.headerNames[o]||e;t.headers[s]&&(n=t.headers[s]+", "+n),t.headers[s]=n},b.getResponseHeader=e=>f(a.headers[e?e.toLowerCase():void 0]),b.getAllResponseHeaders=()=>f(l(a.headers)),e.overrideMimeType&&(b.overrideMimeType=function(){e.overrideMimeType.apply(e,arguments)}),e.upload){let e=u();b.upload=e,t.upload=e}return b.UNSENT=0,b.OPENED=1,b.HEADERS_RECEIVED=2,b.LOADING=3,b.DONE=4,b.response="",b.responseText="",b.responseXML=null,b.readyState=0,b.statusText="",b};h.UNSENT=0,h.OPENED=1,h.HEADERS_RECEIVED=2,h.LOADING=3,h.DONE=4;var y={patch(){p&&(n.XMLHttpRequest=h)},unpatch(){p&&(n.XMLHttpRequest=p)},Native:p,Xhook:h};const v=d;return v.EventEmitter=u,v.before=function(e,t){if(e.length<1||e.length>2)throw"invalid hook";return v.on("before",e,t)},v.after=function(e,t){if(e.length<2||e.length>3)throw"invalid hook";return v.on("after",e,t)},v.enable=function(){y.patch()},v.disable=function(){y.unpatch()},v.XMLHttpRequest=y.Native,v.headers=l,v.enable(),v}();